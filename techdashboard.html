<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>All Ticket - HelpDesk </title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
        crossorigin="anonymous">
    <!-- jQuery and JS bundle w/ Popper.js -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"
        crossorigin="anonymous"></script>
    <link rel="stylesheet" href="assets/bootstrap/bootstrap.css">
    <link rel="stylesheet" href="assets/css/ticket.css">
    <link href="assets/font-awesome/css/font-awesome.min.css" rel="stylesheet">
    <link
        href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,700,700i|Roboto:100,300,400,500,700|Philosopher:400,400i,700,700i"
        rel="stylesheet">
    <script src="modules/index.js"></script>
    <script src="modules/ticket.js"></script>

    <link rel="stylesheet" href="assets/css/list_ticket.css">
    <style>

    </style>
</head>

<body>
    <header id="header">
        <!-- Load Header content-->
    </header>
    <main class="container-fluid">
        <div id="page-content">
            <div class="about-content">
                <div id="username">

                </div>
            </div>
            <hr><br>
            <div class="container">
                <div class="row">
                    <div class="col-3">
                        <label>Search By Priority</label>
                        <select id="priority" onchange="filterByPriority(this.value)">
                            <option value="ALL">--ALL--</option>
                            <option value="High">High</option>
                            <option value="Medium">Medium</option>
                            <option value="Low">Low</option>
                        </select>
                    </div>
                    <div class="col-3">
                        <label>Search By Status</label>
                        <select id="priority" onchange="filterByStatus(this.value)">
                            <option value="ALL">--ALL--</option>
                            <option value="Open">Open</option>
                            <option value="Close">Close</option>
                            <option value="In-progress">In-progress</option>
                            <option value="Completed">Completed</option>
                        </select>
                    </div>
                    <div class="col-3">
                        <label>Search By Assigned To</label>
                        <select id="priority" onchange="filterByAssigned(this.value)">
                            <option value="ALL">--ALL--</option>
                            <option value="Development Team">Development Team</option>
                            <option value="Hardware Team">Hardware Team</option>
                            <option value="Software Team">Software Team</option>
                            <option value="Sales Team">Sales Team</option>
                            <option value="Csml Team">Csml Team</option>
                            <option value="Networking Team">Networking Team</option>
                        </select>
                    </div>
                    <div class="col-3">
                        <label>Search By Unassigned Ticket</label>
                        <select id="priority" onchange="filterByUnassigned(this.value)">
                            <option value="ALL">--ALL--</option>
                            <option value="Team">Unassigned Ticket</option>
                           
                        </select>
                    </div>
                </div>
            </div>

            <div id="message">

            </div>
            <div class="table-div" id='card-table'>

                <table class="table" id="tblContainer">
                    <thead>
                        <tr>
                            <th> S.no </th>
                            <th> Token Id</th>
                            <th> Title </th>
                            <th>Email Id</th>
                            <th>Priority</th>
                            <th>Status</th>
                            <th>View Details</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>

        </div>
    </main>
    <hr>
    <!-- <div id="page-content">
        <div class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel"
            aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="about-content">
                        <h2><span>View Complete Detail Of Generated Tickets</span></h2>
                    </div>
                    <div class="row">
                        <div class="col-md-4">
                            <table border="1" class="table" id="tablestyle">
                                <thead>
                                    <tr>
                                        <td>Token Id</td>
                                    </tr>
                                    <tr>
                                        <td> Title </td>
                                    </tr>
                                    <tr>
                                        <td>Customer Name</td>
                                    </tr>
                                    <tr>
                                        <td> Email </td>
                                    </tr>
                                    <tr>
                                        <td> Department</td>
                                    </tr>
                                    <tr>
                                        <td>Assigned To</td>
                                    </tr>
                                    <tr>
                                        <td>Priority</td>
                                    </tr>
                                    <tr>
                                        <td>Problem</td>
                                    </tr>
                                    <tr>
                                        <td>Mobile Number</td>
                                    </tr>
                                    <tr>
                                        <td>Ticket Status</td>
                                    </tr>
                                    <tr>
                                        <td>Date Of Generated Ticket</td>
                                    </tr>
                                    <tr>
                                        <td>Action</td>
                                    </tr>
                                </thead>
                            </table>
                        </div>
                        <div class="col-md-8 ml-auto">
                            <div id="details"></div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
    </div> -->
    <section id="media" style="margin-top: 20px;">
        <br><br>
        <div class="container">
            <div class="row justify-content-center">
                <div class="about-content">
                    <h2><span>CONNECT WITH US</span></h2>
                    <div class="row justify-content-center">
                        <i class="fa fa-twitter-square fa-2x p-1" aria-hidden="true"></i>
                        <i class="fa fa-facebook-square  fa-2x p-1" aria-hidden="true"></i>
                        <i class="fa fa-linkedin-square  fa-2x p-1" aria-hidden="true"></i>
                        <i class="fa fa-google-plus-square  fa-2x p-1" aria-hidden="true"></i>
                        <i class="fa fa-instagram  fa-2x p-1" aria-hidden="true"></i>
                    </div>
                </div>
            </div>
        </div>
    </section>
<footer class="footer bg-light" >
        <div class="copyrights">
            <div class="container-fluid bg-light">
                <p>&copy; Copyrights HelpDesk. All rights reserved.</p>

            </div>
        </div>

    </footer>
    <script src="modules/util.js"></script>
    <script src="modules/techdashboard.js"></script>
    <script>
        $("#header").load("components/_headertech.html");
    </script>
    <script>
        var obj = JSON.parse(localStorage.getItem("LOGGED_IN_USER"));
        document.getElementById("username").innerHTML = "Welcome" + " " + obj.name + " ";
        
        function displaytickets() {

            var tickets = new addTicket().list();

            console.log(tickets);
            displayTickets(tickets);
        }
        function viewdetails(views) {

            console.log(views);
            var tickets = new addTicket().list();
            console.log(tickets);

            let index = tickets.findIndex(obj => obj.tel == views);
            console.log(index);
            if (tickets.length > 0) {
                var obj = tickets[index];
                let closeBtn = `<button id='close' class="btn btn-secondary" onclick="close1(${obj.id})">Close&nbsp;Ticket</button>`;
                var newticket = obj.id + '<br>' + obj.title + '<br>' + obj.cname + '<br>' + obj.email + '<br>' + obj.department + '<br>' + obj.Team + '<br>' + obj.priority
                    + '<br>' + obj.textarea + '<br>' + obj.tel + '<br>' + obj.ticketstatus + '<br>' + obj.date + '<br>' + closeBtn;

            }
            document.getElementById('details').innerHTML = newticket;
        }


        function displayTickets(tickets) {
            $("table tbody").empty();
            let sno = 0;
            if (tickets.length > 0) {
                for (var obj of tickets) {
                    let viewBtn = `<a href="view_details.html?ticketId=${obj.id}"><button class="btn btn-success">View</button></a>`;
                    let closeBtn = `<button id='close' class="btn btn-secondary" onclick="close1(${obj.id})">Close&nbsp;Ticket</button>`;
                    let deleterecord = `<button class="btn btn-danger" onclick="deleteRecord(${obj.tel})">Delete</button>`;
                    var new_row = "<tr><td>" + ++sno + "</td><td>" + obj.id + "</td><td>" + obj.title + "</td><td>" + obj.email + "</td><td>" + obj.priority + "</td><td>" + obj.ticketstatus + "</td><td>" + viewBtn + "</td></tr>";
                    $("table tbody").append(new_row);
                }
                document.querySelector("#card-table").style.display = "block";
                document.querySelector("#message").style.display = "none";
            }
            else {
                document.querySelector("#card-table").style.display = "none";
                document.querySelector("#message").style.display = "block";
                document.querySelector("#message").innerHTML = "<div class='alert alert-danger'>No Ticket Available.</div>";
            }
        }
        function filterByPriority(priority) {

            var tickets = JSON.parse(localStorage.getItem("TICKET")) || [];

            let filteredData = null;
            if (priority == 'ALL') {
                filteredData = tickets;
            }
            else {
                filteredData = tickets.filter(obj => obj.priority == priority);
            }
            console.log(filteredData);
            //document.querySelector("#result").innerHTML = JSON.stringify(filteredData);
            displayTickets(filteredData);
        }
        filterByPriority('ALL');

        function filterByStatus(ticketstatus) {

            var tickets = JSON.parse(localStorage.getItem("TICKET")) || [];

            let filteredData = null;
            if (ticketstatus == 'ALL') {
                filteredData = tickets;
            }
            else {
                filteredData = tickets.filter(obj => obj.ticketstatus == ticketstatus);
            }
            console.log(filteredData);
            //document.querySelector("#result").innerHTML = JSON.stringify(filteredData);
            displayTickets(filteredData);
        }
        filterByStatus('ALL');

        function filterByAssigned(Team) {

            var tickets = JSON.parse(localStorage.getItem("TICKET")) || [];

            let filteredData = null;
            if (Team == 'ALL') {
                filteredData = tickets;
            }
            else {
                filteredData = tickets.filter(obj => obj.Team == Team);
            }
            console.log(filteredData);
            //document.querySelector("#result").innerHTML = JSON.stringify(filteredData);
            displayTickets(filteredData);
        }
        filterByStatus('ALL');

        function filterByUnassigned(Team) {

            var tickets = JSON.parse(localStorage.getItem("TICKET")) || [];

            let filteredData = null;
            if (Team == 'ALL') {
                filteredData = tickets;
            }
            else {
                filteredData = tickets.filter(obj => obj.Team == "");
            }
            console.log(filteredData);
            //document.querySelector("#result").innerHTML = JSON.stringify(filteredData);
            displayTickets(filteredData);
        }
        filterByUnassigned('ALL');
        displaytickets();
       /* function deleteRecord(num) {
              console.log("Going to delete");
              console.log(num);
              let tickets = new addTicket().list();
              let index = tickets.findIndex(obj => obj.tel == num);
              tickets.splice(index, 1);
              console.log(index);
              localStorage.setItem("TICKET", JSON.stringify(tickets));
              location.reload();
          }*/

        /* function close1(id) {
            var ticketid;
            var tickets = new addTicket().list();
            var tickets = JSON.parse(localStorage.getItem("TICKET")) || [];
            let index = tickets.findIndex(obj => obj.id == id); // This should return index

            let ticketObj = tickets[index];
            //update ticket status to close
            ticketObj["ticketstatus"] = "Close";
            //update the modified object to tickets array
            tickets[index] = ticketObj;

            //update in localStorage
            localStorage.setItem("TICKET", JSON.stringify(tickets));
            location.reload();

        }*/
        /* function assign(team) {
             //var assignTo = document.getElementById('assignTo').value;
             if (document.getElementById('techteam').checked) {
                 assignTo = document.getElementById('techteam').value;
             }
             else if (document.getElementById('networkingTeam').checked) {
                 assignTo = document.getElementById('networkingTeam').value;
             }
             else if (document.getElementById('softwareTeam').checked) {
                 assignTo = document.getElementById('softwareTeam').value;
             }
             else if (document.getElementById('operatingTeam').checked) {
                 assignTo = document.getElementById('operatingTeam').value;
             }
             let users = JSON.parse(localStorage.getItem("USERS")) || [];
             console.log(assignTo);
             let members = users.filter(obj => obj.team == assignTo);
             console.log(members);
             let content = "";
             for (let m of members) {
                 content += `${m.name}`;
             }
             console.log(content);
             var tickets = JSON.parse(localStorage.getItem("TICKET")) || [];
             let index = tickets.findIndex(obj => obj.team == team);
             let ticketObj = tickets[index];
             ticketObj["Team"] = content;
             tickets[index] = ticketObj;
             console.log(ticketObj);
             localStorage.setItem("TICKET", JSON.stringify(tickets));
             location.reload();

             var userObj = { "assignTo": assignTo };
             console.log(assignTo);
             var addTicketObj = new assigned();
             let result = addTicketObj.assign(userObj); */
    </script>


</body>

</html>
