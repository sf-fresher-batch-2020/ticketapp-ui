<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>All Ticket - HelpDesk </title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
        crossorigin="anonymous">
    <!-- jQuery and JS bundle w/ Popper.js -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"
        crossorigin="anonymous"></script>
    <link rel="stylesheet" href="assets/bootstrap/bootstrap.css">
    <link rel="stylesheet" href="assets/css/ticket.css">
    <link href="assets/font-awesome/css/font-awesome.min.css" rel="stylesheet">
    <link
        href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,700,700i|Roboto:100,300,400,500,700|Philosopher:400,400i,700,700i"
        rel="stylesheet">
    <script src="modules/index.js"></script>
    <script src="modules/ticket.js"></script>

    <link rel="stylesheet" href="assets/css/view_details.css">
</head>

<body>
    <header id="header">
        <!-- Load Header content-->
    </header>
    <main class="container-fluid">
        <div id="page-content">
            <div class="about-content ">
                <h2 class=" row justify-content-center"><span>View Complete Detail Of Generated Tickets</span></h2>
            </div>
        </div>
    </main>
    <hr>
    
        <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-3">
                <table border="1" class="table" id="tablestyle">
                    <thead>
                        <tr>
                            <th>Token Id</th>
                        </tr>
                        <tr>
                            <th> Title </th>
                        </tr>

                        <tr>
                            <th>Customer Name</th>
                        </tr>

                        <tr>
                            <th> Email </th>
                        </tr>

                        <tr>
                            <th> Department</th>
                        </tr>
                       
                        <tr>
                            <th>Priority</th>
                        </tr>
                        <tr>
                            <th>Problem</th>
                        </tr>
                        <tr>
                            <th>Mobile Number</th>
                        </tr>
                        <tr>
                            <th>Ticket Status</th>
                        </tr>
                        <tr>
                            <th>Date Of Generated Ticket</th>
                        </tr>
                        <tr>
                            <th>Action</th>
                        </tr>
                        <tr>
                            <th>Assigned To</th>
                        </tr>
                    </thead>
                </table>
               
            </div>
            <div class="col-md-9">
                <table class="table">
                    <tbody  id="details">
                    </tbody>
                </table>
                
            </div>
        </div>
        </div>
        
        <section id="media" style="margin-top: 20px;">
            <br><br>
            <div class="container">
                <div class="row justify-content-center">
                    <div class="about-content">
                        <h2><span>CONNECT WITH US</span></h2>
                        <div class="row justify-content-center">
                            <i class="fa fa-twitter-square fa-2x p-1" aria-hidden="true"></i>
                            <i class="fa fa-facebook-square  fa-2x p-1" aria-hidden="true"></i>
                            <i class="fa fa-linkedin-square  fa-2x p-1" aria-hidden="true"></i>
                            <i class="fa fa-google-plus-square  fa-2x p-1" aria-hidden="true"></i>
                            <i class="fa fa-instagram  fa-2x p-1" aria-hidden="true"></i>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <footer class="footer" style="margin-top: 30px;">
            <div class="container-fluid ">
                <div class="row">

                    <div class="col-md-12 col-lg-4">
                        <div class="footer-logo">

                            <a class="navbar-brand" href="#">eStartup</a>
                            <p>Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum
                                has
                                been the industry's standard dummy text ever since the.</p>
                        </div>
                    </div>

                    <div class="col-sm-6 col-md-3 col-lg-2">
                        <div class="list-menu">

                            <h4>1</h4>

                            <ul class="list-unstyled">
                                <li><a href="#">#</a></li>
                                <li><a href="#">#</a></li>
                                <li><a href="#">#</a></li>
                                <li><a href="#">#</a></li>
                            </ul>

                        </div>
                    </div>

                    <div class="col-sm-6 col-md-3 col-lg-2">
                        <div class="list-menu">

                            <h4>2</h4>

                            <ul class="list-unstyled">
                                <li><a href="#">#</a></li>
                                <li><a href="#">#</a></li>
                                <li><a href="#">#</a></li>
                                <li><a href="#">#</a></li>
                            </ul>

                        </div>
                    </div>

                    <div class="col-sm-6 col-md-3 col-lg-2">
                        <div class="list-menu">

                            <h4>3</h4>

                            <ul class="list-unstyled">
                                <li><a href="#">#</a></li>
                                <li><a href="#">#</a></li>
                                <li><a href="#">#</a></li>
                                <li><a href="#">#</a></li>
                            </ul>

                        </div>
                    </div>

                    <div class="col-sm-6 col-md-3 col-lg-2">
                        <div class="list-menu">

                            <h4>4</h4>

                            <ul class="list-unstyled">
                                <li><a href="#">#</a></li>
                                <li><a href="#">#</a></li>
                                <li><a href="#">#</a></li>
                                <li><a href="#">#</a></li>
                            </ul>

                        </div>
                    </div>

                </div>
            </div>

            <div class="copyrights">
                <div class="container-fluid bg-light">
                    <p>&copy; Copyrights eStartup. All rights reserved.</p>

                </div>
            </div>

        </footer>
        <script src="modules/util.js"></script>
        <script>
            $("#header").load("components/_headertech.html");
        </script>
        <script>



            function deleteRecord(num) {
                console.log("Going to delete");
                console.log(num);
                let tickets = new addTicket().list();
                let index = tickets.findIndex(obj => obj.tel == num);
                tickets.splice(index, 1);
                console.log(index);
                localStorage.setItem("TICKET", JSON.stringify(tickets));
                location.reload();
            }
            function viewdetails(ticketId) {

                console.log(ticketId);
                var tickets = new addTicket().list();
                console.log(tickets);
                var tickets = JSON.parse(localStorage.getItem("TICKET")) || [];
                let obj = tickets.find(obj => obj.id == ticketId);
                console.log(obj);
                let newticket = "";
                let content = "";
                if (obj) {
                    let assignBtn = `<button  class="btn btn-info" onclick="assign(${obj.ticketid})">Assign&nbsp;To</button>`;
                    let closeBtn = `<button id='close' class="btn btn-secondary" onclick="close1(${obj.id})">Close&nbsp;Ticket</button>`;
                    let assignTo = displayAssignTo();
                    content += `<tr ><td>${obj.id}</td></tr><td>${obj.title}</td></tr><tr><td>${obj.cname}</td></tr>
                    <tr><td>${obj.email}</td></tr><tr><td>${obj.department}</td></tr>
                    <tr><td>${obj.priority}</td></tr><tr><td>${obj.textarea}</td></tr><tr><td>${obj.tel}</td></tr>
                    <tr><td>${obj.ticketstatus}</td></tr><tr><td>${obj.date}</td></tr>
                    <tr><td>${closeBtn}</td></tr><tr><td>${assignTo}&nbsp;&nbsp;${assignBtn}</td></tr>`;
                    /*newticket = obj.id + '<br>' + obj.title + '<br>' + obj.cname + '<br>' + obj.email + '<br>' + obj.department + '<br>' + obj.Team + '<br>' + obj.priority
                        + '<br>' + obj.textarea + '<br>' + obj.tel + '<br>' + obj.ticketstatus + '<br>' + obj.date + '<br>' + closeBtn + '<br>' + assignTo;
*/
                } console.log(newticket);
                document.querySelector("#details").innerHTML = content;
            }

            function displayAssignTo() {
                let newticket;
                let content = `<select id="assignTo">`;
                let members = [
                { id: "", name: "--Select One Option--" },
                {id: "Development Team", name: "Development Team" }, 
                { id: "Hardware Team", name: "Hardware Team" },
                { id:"Software Team", name: "Software Team" },
                { id:"Sales Team", name: "Sales Team" },
                { id:"Csml Team", name: "Csml Team" },
                { id:"Networking Team", name: "Networking Team" },];
                for (let obj of members) {
                    content += `<option value="${obj.id}">${obj.name}</option>`;
                }
                content += `</select>`;
                console.log(content);
                document.querySelector("#details").innerHTML = content;
                return content;
                
            }

            function close1(id) {
                var ticketid;
                var tickets = new addTicket().list();
                var tickets = JSON.parse(localStorage.getItem("TICKET")) || [];
                let index = tickets.findIndex(obj => obj.id == id); // This should return index

                let ticketObj = tickets[index];
                //update ticket status to close
                ticketObj["ticketstatus"] = "Close";
                //update the modified object to tickets array
                tickets[index] = ticketObj;

                //update in localStorage
                localStorage.setItem("TICKET", JSON.stringify(tickets));
                location.reload();

            }
            function assign(ticketid) {
                //var assignTo = document.getElementById('assignTo').value;
                let assignTicket= document.querySelector("#assignTo").value;
                console.log(assignTicket);
                var tickets = JSON.parse(localStorage.getItem("TICKET")) || [];
                let index = tickets.findIndex(obj => obj.assignTicket == ticketid);
                let ticketObj = tickets[index];
                ticketObj["Team"] = assignTicket;
                tickets[index] = ticketObj;
                console.log(ticketObj);
                //localStorage.setItem("TICKET", JSON.stringify(tickets));
                //location.reload();

                /*var userObj = { "assignTo": assignTo };
                console.log(assignTo);
                var addTicketObj = new assigned();
                let result = addTicketObj.assign(userObj);*/
            }

            let ticketIdStr = getParameterByName("ticketId");
            console.log("Query Param: ticketId ", ticketIdStr);
            if (ticketIdStr) {
                let ticketId = parseInt(ticketIdStr);
                console.log(ticketId);
                viewdetails(ticketId);
            }
        </script>
        <script src="modules/techdashboard.js"></script>
</body>

</html>